<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ·±æ¸Šå›å“ - Abyss Echo</title>
    <style>
        /* ==================== 
           CSS æ ·å¼è¡¨ï¼šå†³å®šæ¸¸æˆå¤–è§‚ 
           ==================== */
        body {
            background-color: #000;
            color: #dcdcdc;
            font-family: 'Courier New', Courier, monospace; /* å¤å¤å­—ä½“ */
            margin: 0;
            display: flex;
            justify-content: center;
            height: 100vh;
            overflow: hidden; /* ç¦æ­¢é¡µé¢æ•´ä½“æ»šåŠ¨ */
        }

        #game-container {
            width: 100%;
            max-width: 450px; /* é™åˆ¶å®½åº¦ï¼Œæ¨¡æ‹Ÿæ‰‹æœºç«–å± */
            height: 100%;
            background-color: #111;
            display: flex;
            flex-direction: column;
            position: relative;
            border-left: 1px solid #333;
            border-right: 1px solid #333;
            box-shadow: 0 0 20px rgba(0,0,0,0.8);
        }

        /* é¡¶éƒ¨åŠŸèƒ½æ  */
        #top-bar {
            position: absolute;
            top: 0;
            width: 100%;
            padding: 8px;
            box-sizing: border-box;
            display: flex;
            justify-content: flex-end;
            z-index: 100;
            background: linear-gradient(to bottom, rgba(0,0,0,0.8), transparent);
        }

        .small-btn {
            background: rgba(50, 50, 50, 0.8);
            color: #aaa;
            border: 1px solid #555;
            padding: 4px 8px;
            font-size: 12px;
            margin-left: 8px;
            border-radius: 4px;
            cursor: pointer;
        }

        /* ä¸ŠåŠéƒ¨åˆ†ï¼šç”»é¢åŒº */
        #visual-area {
            flex: 4; /* ç”»é¢å  4/10 */
            background-color: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow: hidden;
            border-bottom: 4px solid #333;
        }

        /* SVG å®¹å™¨ï¼Œç¡®ä¿å›¾ç‰‡æ’‘æ»¡ */
        .svg-scene {
            width: 100%;
            height: 100%;
            display: block;
        }

        /* ç©å®¶å¤´åƒ */
        #player-avatar {
            position: absolute;
            bottom: 10%;
            width: 80px;
            height: 80px;
            image-rendering: pixelated; /* åƒç´ é£æ ¼ä¸æ¨¡ç³Š */
            z-index: 10;
            filter: drop-shadow(0 4px 4px rgba(0,0,0,0.5));
            transition: transform 0.3s ease;
        }

        /* ä¸‹åŠéƒ¨åˆ†ï¼šæ–‡æœ¬å’Œæ“ä½œåŒº */
        #text-area {
            flex: 6; /* æ–‡æœ¬å  6/10 */
            padding: 20px;
            display: flex;
            flex-direction: column;
            background-color: #1a1a1a;
        }

        #dialogue-box {
            flex-grow: 1;
            font-size: 16px;
            line-height: 1.6;
            margin-bottom: 20px;
            overflow-y: auto; /* æ–‡æœ¬å¤ªé•¿å¯æ»šåŠ¨ */
            color: #eee;
            text-shadow: 1px 1px 0 #000;
        }
        
        /* å…³é”®æ–‡æœ¬é«˜äº® */
        .highlight { color: #e74c3c; font-weight: bold; }
        .item-get { color: #f1c40f; font-weight: bold; }

        /* æŒ‰é’®ç»„ */
        .btn-group {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
        }

        button.choice-btn {
            background: #2c3e50;
            color: white;
            border: 2px solid #34495e;
            padding: 16px;
            font-family: inherit;
            font-size: 16px;
            cursor: pointer;
            text-align: left;
            border-radius: 8px;
            transition: background 0.2s;
        }
        
        button.choice-btn:active {
            background: #1abc9c;
            border-color: #16a085;
            transform: translateY(2px);
        }

        /* ç®€å•çš„æ·¡å…¥åŠ¨ç”» */
        .fade-in {
            animation: fadeIn 0.5s;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>
<body>

<div id="game-container">
    <!-- é¡¶éƒ¨èœå• -->
    <div id="top-bar">
        <button class="small-btn" onclick="saveGame()">ä¿å­˜è¿›åº¦</button>
        <button class="small-btn" onclick="loadGame()">è¯»å–è¿›åº¦</button>
        <button class="small-btn" onclick="restart()">é‡ç½®</button>
    </div>

    <!-- ç”»é¢ -->
    <div id="visual-area">
        <!-- èƒŒæ™¯ SVG å°†è¢«æ’å…¥è¿™é‡Œ -->
    </div>

    <!-- æ–‡æœ¬ä¸äº¤äº’ -->
    <div id="text-area">
        <div id="dialogue-box" class="fade-in">æ­£åœ¨åˆå§‹åŒ–æ·±æ¸Š...</div>
        <div class="btn-group" id="choices"></div>
    </div>
</div>

<script>
    // ==========================================
    // 1. èµ„æºç´ æåº“ (SVG ä»£ç )
    // ==========================================
    
    // åœºæ™¯ï¼šæ·±å‘ (ä»°è§†è§†è§’ï¼Œé»‘æš—ï¼Œå¾®å…‰)
    const img_pit = `
    <svg class="svg-scene" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="none">
        <defs>
            <linearGradient id="grad_pit" x1="0%" y1="0%" x2="0%" y2="100%">
                <stop offset="0%" style="stop-color:#111;stop-opacity:1" />
                <stop offset="100%" style="stop-color:#000;stop-opacity:1" />
            </linearGradient>
        </defs>
        <rect width="100" height="100" fill="url(#grad_pit)"/>
        <!-- å²©å£ -->
        <path d="M0,0 L30,0 L20,100 L0,100 Z" fill="#222"/>
        <path d="M100,0 L70,0 L80,100 L100,100 Z" fill="#222"/>
        <!-- è—¤è”“ -->
        <path d="M20,10 Q40,30 15,60 T25,90" stroke="#27ae60" stroke-width="2" fill="none"/>
        <path d="M80,5 Q60,40 85,70 T75,95" stroke="#27ae60" stroke-width="2" fill="none"/>
        <path d="M10,0 L15,40" stroke="#1e8449" stroke-width="3" fill="none"/>
        <!-- é¡¶éƒ¨å¾®å…‰ -->
        <ellipse cx="50" cy="0" rx="40" ry="10" fill="#ecf0f1" opacity="0.1"/>
    </svg>`;

    // åœºæ™¯ï¼šç¥­å› (ç‰¹å†™ï¼Œè¯¡å¼‚çº¢å…‰)
    const img_altar = `
    <svg class="svg-scene" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="none">
        <rect width="100" height="100" fill="#1a1a1a"/>
        <!-- ç¥­å›åº•åº§ -->
        <rect x="10" y="40" width="80" height="60" fill="#34495e"/>
        <rect x="5" y="40" width="90" height="5" fill="#2c3e50"/>
        <!-- çº¢è‰²ç¬¦æ–‡ (å‘å…‰æ•ˆæœ) -->
        <path d="M30,60 L50,85 L70,60 M50,50 L50,90 M30,75 L70,75" stroke="#c0392b" stroke-width="3" fill="none" opacity="0.8"/>
        <!-- æ‚è‰è¦†ç›– -->
        <path d="M10,100 L15,80 L20,100 M80,100 L85,85 L90,100" stroke="#27ae60" stroke-width="2" fill="none"/>
    </svg>`;

    // è§’è‰²ï¼šçº¢è¡£å‹‡è€… (Base64 SVG)
    const avatar_red = `data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><rect width='16' height='16' fill='transparent'/><rect x='6' y='2' width='4' height='4' fill='%23f1c40f'/><rect x='5' y='6' width='6' height='8' fill='%23e74c3c'/><rect x='4' y='8' width='2' height='4' fill='%23c0392b'/><rect x='10' y='8' width='2' height='4' fill='%23c0392b'/><rect x='4' y='14' width='3' height='2' fill='%23333'/><rect x='9' y='14' width='3' height='2' fill='%23333'/></svg>`;

    // è§’è‰²ï¼šè“è¡£æ³•å¸ˆ (Base64 SVG)
    const avatar_blue = `data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><rect width='16' height='16' fill='transparent'/><rect x='6' y='3' width='4' height='3' fill='%23f1c40f'/><polygon points='4,2 12,2 8,0' fill='%233498db'/><rect x='5' y='6' width='6' height='9' fill='%233498db'/><rect x='11' y='6' width='1' height='10' fill='%23ecf0f1'/><rect x='5' y='15' width='6' height='1' fill='%232c3e50'/></svg>`;

    // ==========================================
    // 2. æ¸¸æˆå‰§æœ¬é…ç½® (Script)
    // ==========================================
    
    // ä½ å¯ä»¥åœ¨è¿™é‡Œæ— é™æ‰©å±•å‰§æƒ…
    const scenes = {
        'start': {
            text: "ã€è§’è‰²åˆ›å»ºã€‘\n\næ·±æ¸Šåœ¨å‘¼å”¤ä½ çš„åå­—...\nä½ è¦ä»¥ä»€ä¹ˆèº«ä»½å¼€å§‹è¿™åœºå†’é™©ï¼Ÿ",
            visual: img_pit,
            choices: [
                { text: "æˆ‘æ˜¯çº¢è¡£æˆ˜å£« (åŠ›é‡)", action: () => selectAvatar('red') },
                { text: "æˆ‘æ˜¯è“è¡£æ³•å¸ˆ (æ™ºæ…§)", action: () => selectAvatar('blue') }
            ]
        },
        'pit_wakeup': {
            text: "ä½ çŒ›ç„¶æƒŠé†’ï¼Œæµ‘èº«é…¸ç—›ã€‚æŠ¬å¤´æœ›å»ï¼Œå¤´é¡¶åªæœ‰ä¸€çº¿å¾®å¼±çš„å¤©å…‰ï¼Œè·ç¦»åœ°é¢è‡³å°‘æœ‰ç™¾ç±³ä¹‹é«˜ã€‚\n\nä½ å‘ç°è‡ªå·±èº«å¤„ä¸€ä¸ªå·¨å¤§çš„æ·±å‘åº•éƒ¨ï¼Œå››å‘¨çš„å²©å£æ¹¿æ»‘é™¡å³­ï¼Œå‘¨å›´éå¸ƒç€åŠäººé«˜çš„æ‚è‰å’Œçº ç¼ çš„è—¤è”“ã€‚",
            visual: img_pit,
            choices: [
                { text: "æŸ¥çœ‹å››å‘¨ç¯å¢ƒ", target: 'explore_pit' },
                { text: "æ£€æŸ¥éšèº«ç‰©å“", target: 'check_inventory' }
            ]
        },
        'check_inventory': {
            text: "ä½ æ‘¸äº†æ‘¸å£è¢‹ï¼Œé™¤äº†ä¸€æŠŠç”Ÿé”ˆçš„åŒ•é¦–å’Œä¸€ä¸ªå¹²ç˜ªçš„æ°´è¢‹ï¼Œä»€ä¹ˆä¹Ÿæ²¡æœ‰ã€‚\n\næ— è®ºä½ æ˜¯è°ï¼Œç°åœ¨ä½ åªæ˜¯ä¸€ä¸ªè¢«å›°åœ¨æ·±æ¸Šçš„å¯æ€œäººã€‚",
            visual: img_pit,
            choices: [
                { text: "æŸ¥çœ‹å››å‘¨", target: 'explore_pit' }
            ]
        },
        'explore_pit': {
            text: "ä½ æ‹¨å¼€é¢å‰èŒ‚å¯†çš„æ‚è‰ï¼Œæ‰‹æŒ‡è§¦ç¢°åˆ°äº†ä¸€äº›åšç¡¬å†°å‡‰çš„ä¸œè¥¿ã€‚\n\nè¿™æ˜¯ä¸€ä¸ªçœ‹èµ·æ¥å·²ç»åºŸå¼ƒäº†æ•°ç™¾å¹´çš„å¤è€ç¥­å›ï¼Œå¤§åŠä¸ªç¥­å›éƒ½è¢«åŸ‹åœ¨åœŸé‡Œã€‚ä½ ç”¨åŠ›æ‰’å¼€è¦†ç›–åœ¨ä¸Šé¢çš„æ¯è—¤...",
            visual: img_pit,
            choices: [
                { text: "æŒ–æ˜ç¥­å›", target: 'examine_altar' }
            ]
        },
        'examine_altar': {
            text: "è—¤è”“æ•£å»ï¼Œæ˜¾éœ²å‡ºçŸ³å¤´ç Œæˆçš„åº•åº§ã€‚ä»¤äººä¸å®‰çš„æ˜¯ï¼Œç¥­å›è¡¨é¢å¸ƒæ»¡äº†ç”¨æŸç§<span class='highlight'>æ·±çº¢è‰²é¢œæ–™</span>ç»˜åˆ¶çš„å¤æ‚çº¹è·¯ã€‚\n\nè™½ç„¶å¹´ä»£ä¹…è¿œï¼Œä½†é‚£çº¢è‰²ä¾ç„¶é²œè‰³å¾—åˆºçœ¼ï¼Œä»¿ä½›æ˜¯åˆšç”»ä¸Šå»çš„ã€‚",
            visual: img_altar, // åˆ‡æ¢å›¾ç‰‡
            choices: [
                { text: "è§¦æ‘¸é‚£äº›çº¹è·¯", target: 'touch_rune' },
                { text: "è¿œç¦»è¿™é‡Œï¼Œæ‰¾åˆ«çš„è·¯", target: 'leave_altar' }
            ]
        },
        'touch_rune': {
            text: "å½“ä½ æŒ‡å°–è§¦ç¢°åˆ°çº¢è‰²çº¹è·¯æ—¶ï¼Œä¸€è‚¡åˆºéª¨çš„å¯’æ„ç¬é—´é’»å…¥ä½ çš„éª¨é«“ï¼\n\nç¥­å›æ·±å¤„ä¼ æ¥äº†ä½æ²‰çš„è½°é¸£å£°...\n\n(Demo ç‰ˆæœ¬åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢æ¸¸ç©)",
            visual: img_altar,
            choices: [
                { text: "é‡æ–°å¼€å§‹", action: () => restart() }
            ]
        },
        'leave_altar': {
             text: "ç›´è§‰å‘Šè¯‰ä½ ï¼Œç¢°è¿™ä¸ªä¸œè¥¿æ²¡æœ‰å¥½ä¸‹åœºã€‚ä½ é€€åå‡ æ­¥ï¼Œè¯•å›¾å¯»æ‰¾å…¶ä»–çš„å‡ºå£ï¼Œä½†å››å‘¨é™¤äº†æ»‘è…»çš„å²©å£ä»€ä¹ˆä¹Ÿæ²¡æœ‰ã€‚",
             visual: img_pit, // åˆ‡å›æ·±å‘å›¾
             choices: [
                 { text: "è¿˜æ˜¯å›å»çœ‹çœ‹ç¥­å›å§", target: 'examine_altar' }
             ]
        }
    };

    // ==========================================
    // 3. æ¸¸æˆæ ¸å¿ƒå¼•æ“ (Engine)
    // ==========================================
    
    let gameState = {
        scene: 'start',
        inventory: [],
        avatar: null
    };

    function renderScene(sceneId) {
        const sceneData = scenes[sceneId];
        if (!sceneData) return;
        
        gameState.scene = sceneId;

        // 1. æ›´æ–°æ–‡æœ¬ï¼ˆå¸¦æ·¡å…¥æ•ˆæœï¼‰
        const txtBox = document.getElementById('dialogue-box');
        txtBox.classList.remove('fade-in');
        void txtBox.offsetWidth; // è§¦å‘é‡ç»˜
        txtBox.innerHTML = sceneData.text; // ä½¿ç”¨innerHTMLæ”¯æŒé¢œè‰²é«˜äº®
        txtBox.classList.add('fade-in');

        // 2. æ›´æ–°èƒŒæ™¯ç”»é¢
        const visualArea = document.getElementById('visual-area');
        // åªæœ‰å½“å›¾ç‰‡æ”¹å˜æ—¶æ‰é‡ç»˜ï¼Œé¿å…é—ªçƒ(ç®€å•ç‰ˆç›´æ¥é‡ç»˜)
        // æ¸…é™¤é™¤äº†avatarä»¥å¤–çš„å…ƒç´ 
        const oldAvatars = visualArea.querySelectorAll('#player-avatar');
        visualArea.innerHTML = sceneData.visual || '';
        
        // 3. é‡æ–°æ’å…¥è§’è‰²å¤´åƒ
        if (gameState.avatar) {
            const avatarImg = document.createElement('img');
            avatarImg.id = 'player-avatar';
            avatarImg.src = gameState.avatar === 'red' ? avatar_red : avatar_blue;
            visualArea.appendChild(avatarImg);
        }

        // 4. ç”Ÿæˆé€‰é¡¹æŒ‰é’®
        const choicesDiv = document.getElementById('choices');
        choicesDiv.innerHTML = ''; 
        if (sceneData.choices) {
            sceneData.choices.forEach(choice => {
                const btn = document.createElement('button');
                btn.className = 'choice-btn';
                btn.innerText = choice.text;
                btn.onclick = () => {
                    if (choice.action) choice.action();
                    if (choice.target) renderScene(choice.target);
                };
                choicesDiv.appendChild(btn);
            });
        }
    }

    function selectAvatar(type) {
        gameState.avatar = type;
        renderScene('pit_wakeup'); // é€‰å®Œäººç›´æ¥è·³åˆ°é†’æ¥åœºæ™¯
    }

    // --- å­˜æ¡£åŠŸèƒ½ ---
    function saveGame() {
        try {
            localStorage.setItem('abyss_echo_save', JSON.stringify(gameState));
            alert('âœ… è¿›åº¦å·²ä¿å­˜');
        } catch(e) {
            alert('âŒ ä¿å­˜å¤±è´¥ï¼Œå¯èƒ½æ˜¯æµè§ˆå™¨é™åˆ¶');
        }
    }

    function loadGame() {
        const saved = localStorage.getItem('abyss_echo_save');
        if (saved) {
            gameState = JSON.parse(saved);
            renderScene(gameState.scene);
        } else {
            alert('ğŸ“­ æ²¡æœ‰æ‰¾åˆ°å­˜æ¡£');
        }
    }

    function restart() {
        if(confirm("ç¡®å®šè¦åˆ é™¤å½“å‰è¿›åº¦å¹¶é‡å¼€å—ï¼Ÿ")) {
            gameState = { scene: 'start', inventory: [], avatar: null };
            renderScene('start');
        }
    }

    // æ¸¸æˆå¯åŠ¨
    window.onload = () => {
        // å¯ä»¥åœ¨è¿™é‡Œæ£€æŸ¥æ˜¯å¦æœ‰è‡ªåŠ¨å­˜æ¡£
        renderScene('start');
    };

</script>
</body>
</html>
